{% load static %}
<section class="m-2 show_profile" style="padding-top: 20px;{% if counter != 1%}display:none;{% endif %}" id="show_profile_{{object.pk}}">
    <div style="position: relative;">
      <h3>{{object.name}}</h3>
      {% if request.user.is_authenticated %}
      <span class="btn btn-primary tooltip tooltip-left generic_delete"
        hx-post="{% url 'main_generic_delete' %}"
        hx-vals='{
          "instance_x": "profile_{{object.pk}}"
        }'
        data-hide="show_profile_{{object.pk}},profile-tab_{{object.pk}}"
        hx-confirm="Delete the profile"
        data-tooltip="Delete the Profile" style="position:absolute; right:5%; top:10px">
          <i class="icon icon-delete"></i>
      </span>
      {% endif %}
    </div>
    <!--show the global profile id for ajax calls-->
    <input name="profile_id" value="{{object.pk}}" style="display:none;">
    <!--the layers-->
    <div id="profiledetail_{{object.pk}}">
    {% if object.layer.first %}
    <!-- <div class="panel" style="max-height:720px; overflow: scroll;"> -->
      <style>
        td{
          padding-top: 2px !important;
          padding-bottom: 2px !important;
        }
      </style>
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            {# this is the draggable column #}
            {% if request.user.is_authenticated %}
            <th></th>
            {% endif %}
            {% include 'main/profile/layer-tablehead.html' with site=object.site %}
            {# this is the menu column #}
            {% if request.user.is_authenticated %}
            <th></th>
            {% endif %}
          </tr>
        </thead>
        <tbody data-url="{% url 'main_layer_positionupdate' object.site.pk %}">
          {% for layer in object.layer.all %}
          <tr class="table_row" id="layer_{{layer.pk}}" data-pos="{{layer.pos}}" style="padding:2px;">
            {% if request.user.is_authenticated %}
            <td class="sort_handle" style="cursor:move;"><i class="icon icon-resize-vert"></i></td>
            {% endif %}
            {% include 'main/profile/layer-tablecells.html' with site=object.site %}
            {% if request.user.is_authenticated %}
            <td>
              <div class="popover popover-left">
                <button class="btn"><i class="icon icon-menu"></i></button>
                <div class="popover-container">
                  <div class="card">
                    <div class="card-body">
                      <button class="btn clone_layer tooltip tooltip-top" data-tooltip="Clone Layer" id="clone_layer_{{layer.pk}}" data-url="{% url 'main_layer_clone' layer.pk %}"><i class="icon icon-plus"></i></button>
                      <button class="btn tooltip tooltip-top generic_rmm2m" data-x="layer_{{layer.pk}}" data-y="profile_{{object.pk}}" data-reload="show_profile_{{object.pk}}" data-tooltip="Remove Layer from Profile"><i class="icon icon-downward"></i></button>
                      <a class="btn tooltip tooltip-top"
                        hx-post="{% url 'main_generic_delete' %}"
                        hx-vals='{
                          "instance_x":"layer_{{layer.pk}}"
                        }'
                        hx-confirm="Delete Layer"
                        hx-target="#layer_{{layer.pk}}"
                        hx-swap="delete"
                        data-tooltip="Delete Layer"
                      ><i class="icon icon-delete"></i></a>
                      <div class="divider"></div>

                      <span class="btn modal_open tooltip tooltip-top" data-tooltip="Edit Layer"
                        hx-get="{% url 'main_modal_get' %}"
                        hx-vals='{"object":"layer_{{layer.pk}}", "type":"edit"}'
                        hx-target="#modal-blank">
                        <i class="icon icon-edit"></i>
                      </span>

                      <span class="btn modal_open tooltip tooltip-top" data-tooltip="Edit Layer Properties"
                        hx-get="{% url 'main_modal_get' %}"
                        hx-vals='{"object":"layer_{{layer.pk}}","type":"properties"}'
                        hx-target="#modal-blank">
                        Prop
                      </span>
                      <div class="divider"></div>
                      <span class="btn modal_open tooltip tooltip-top" data-tooltip="Add Dating"
                        hx-get="{% url 'main_modal_get' %}"
                        hx-vals='{"object":"layer_{{layer.pk}}","type":"dates"}'
                        hx-target="#modal-blank">
                        <i class="icon icon-time"></i>
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </td>
            {% endif %}
          </tr>
          {% endfor %}
        </tbody>
        </table>
        {% if request.user.is_authenticated %}
        <div class="panel-footer">
          <span class="btn btn-primary add_new_layer tooltip tooltip-right"
              data-tooltip="Add a new Layer"
              data-y="profile_{{object.pk}}"
              data-url="{% url 'main_profile_layer_add' %}"
              data-reload="profiledetail_{{object.pk}}">
              <i class="icon icon-plus"></i>
          </span>
        </div>
        {%endif %}
      <br>
    {% else %}
      <div class="empty">
        <div class="empty-icon">
          <i class="icon icon-flag"></i>
        </div>
        <p class="empty-title h5">No Layers</p>
        {% if request.user.is_authenticated %}
        <p class="empty-subtitle">Click the button to add a new Layer.</p>
        <div class="empty-action">
          <button class="btn btn-primary add_new_layer"
              data-y="profile_{{object.pk}}"
              data-url="{% url 'main_profile_layer_add' %}"
              data-reload="profiledetail_{{object.pk}}">
              Add layer
          </button>
        </div>
        {% endif %}
      </div>
    {% endif %}
    </div>
    <!-- Add layers from other profiles -->
    {% if request.user.is_authenticated %}
    {% if object.other_layers %}
    <br><br>
    <div>
        <h5> Add Layer from other profile </h5>
        <table  class="table table-striped table-hover">
          <thead>
            <tr>
              <th>Profile</th>
              {% include 'main/profile/layer-tablehead.html' %}
              <th></th>
              <th></th>
            </tr>
        <tbody id="other_profile_layer_tbody">
        {% for layer in object.other_layers %}
          <tr>
            <td>{{layer.in_profile}}</td>
            {% include 'main/profile/layer-tablecells.html' %}
            <td><span class="btn generic_addm2m" data-x="layer_{{layer.pk}}" data-y="profile_{{object.pk}}" data-reload="show_profile_{{object.pk}}"><i class="icon icon-upward"></span></td>
          </tr>
        {% endfor %}
        </tbody>
        </table><br>
    </div>
    {% endif %}
    {% endif %}
  </section>