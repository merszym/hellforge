{% load static %}
<!DOCTYPE html>
<head>
{% include 'main/timeline/timeline-head.html' %}
<script  src="https://code.jquery.com/jquery-3.6.1.js" integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI="
         crossorigin="anonymous"></script>
</head>
<body>

<style>
.sterile{
    background-color: rgb(117, 117, 117);
}
.hidden{
    background-color: lightgrey !IMPORTANT;
    color: grey
}
.hiddenfill{
    fill: lightgray !IMPORTANT;
    stroke: black;
    color: grey
}
.younger{
  background-image: linear-gradient(to right, rgba(211, 211, 211, 1), rgba(211, 211, 211, 0));
  background-color: rgba(0,0,0,0);
  border: solid 0px grey;
  color: grey;
}
.older{
  background-image: linear-gradient(to right, rgba(211, 211, 211, 0), rgba(211, 211, 211, 1));
  background-color: rgba(0,0,0,0);
  border: solid 0px grey;
  color: grey;
}
.same{
  background-color: lightgrey;
  border: solid 0px grey;
  color: grey;
}

.vis-item .vis-item-overflow {
  overflow: visible;
}
</style>

{% for cult,color in cultures %}
<style>
.{{cult}}{
    background-color:{{color}};
    fill:{{color}};
    stroke:black;
}
</style>
{% endfor %}
<div id="timeline-content">
    <div style="height:400px;" id="visualization"></div>

    <script type="text/javascript">
        // DOM element where the Timeline will be attached
        var container = document.getElementById('visualization');
        var options = {
            'margin':2,
            'width': '100%',
            'zoomMax': 9.4670778000002E+15,
            'zoomMin': 31556926001,
            'zoomKey':'shiftKey',
            'showCurrentTime': false,
            'max': new Date(-1920*31556952000),
            'timeAxis': {scale: 'year', step: 20},
            //'start': new Date(-1970*31556952000),
            'orientation':'both',
            'order': function(a,b){
                if (a.order > b.order) {
                    return -1;
                }
                if (a.order < b.order) {
                    return 1;
                }
                    return 0;
                },
            'format': {
                minorLabels: function(date, scale, step) {
                    return `${parseInt(date.format("YYYY"))*-1} kya`;
                },
            },
            'template': function(item, element, data){
                if (data.usesvg == false){
                    return data.content
                }
                var html = `
                <div style="width:100%; height:32px;">
                    <svg viewBox="0 0 100 110" preserveAspectRatio="none" style="width:100%; height:100%" vector-effect="non-scaling-stroke">
                        <polygon class="${data.className}" points="${data.polygon}" />
                    </svg>
                </div>
                `
                $(element).parent().parent().html(html);
                },
        };
        var groups = JSON.parse("{{ groups|escapejs }}");
        var data = JSON.parse("{{ itemdata|escapejs }}");
        data.forEach(element => {
            element.start = new Date(element.start);
            if(element.end){
                element.end = new Date(element.end);
            }
        });
        var items = new vis.DataSet(data);
        var timeline = new vis.Timeline(container, items, groups, options);
        $(document).ready(function(){
            timeline.zoomOut(0.35);
        })
    </script>
</div>
</body>
</html>